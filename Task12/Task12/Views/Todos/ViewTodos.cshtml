@model IEnumerable<Todo>
@{
    ViewData["Title"] = "";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Task List</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- ✅ Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        .gradient-custom-2 {
            /* Background gradient */
            background: linear-gradient(to right, #6a11cb, #2575fc);
        }

        .mask-custom {
            background: rgba(24, 24, 16, .2);
            border-radius: 2em;
            backdrop-filter: blur(25px);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>

<body>
    <h1>Welcome, @Context.Request.Cookies["UserName"]</h1>
    <p>Feel Free to Create, Update & Delete your todos</p>
    <section class="vh-100 gradient-custom-2">
        <div class="container py-5 h-100">
            <div class="row d-flex justify-content-center align-items-center h-100">
                <div class="col-md-12 col-xl-10">

                    <div class="card mask-custom">
                        <div class="card-body p-4 text-white">

                            <div class="text-center pt-3 pb-2">
                                <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-todo-list/check1.webp"
                                     alt="Check" width="60">
                                <h2 class="my-4">Task List</h2>
                                <a class="btn btn-light btn-outline-dark px-3 py-1" asp-area="" asp-controller="Todos" asp-action="CreateTodo">Create a Todo</a>

                            </div>

                            <table class="table text-white mb-0">
                                <thead>
                                    <tr>
                                        <th scope="col">Title</th>
                                        <th scope="col">Description</th>
                                        <th scope="col">Deadline</th>
                                        <th scope="col">Attached files</th>
                                        <th scope="col">Actions</th>
                                    </tr>
                                </thead>
                                @foreach(var item in Model)
                                {
                                    
                                <tbody>
                                    <tr class="fw-normal">
                                        <th>
                                            <span class="ms-2">@item.Title</span>
                                        </th>
                                        <td class="align-middle">
                                            <span>@item.Description</span>
                                        </td>
                                        <td class="align-middle">
                                            @if(item.DeadLine.Date <= DateTime.Today)
                                                {
                                                <h6 class="mb-0"><span class="badge bg-danger">@item.DeadLine.ToString()</span></h6>
                                                }
                                             else
                                                {
                                                <h6 class="mb-0"><span class="badge bg-success">@item.DeadLine.ToString()</span></h6>
                                                }

                                        </td>
                                        <td class="align-middle">
                                            <a class="bi bi-download fs-4 text-primary" download href="~/TodosFiles/@item.File"></a>
                                        </td>
                                        <td class="align-middle">
                                            <a title="Edit" asp-controller="Todos" asp-action="EditTodo" asp-route-id="@item.Id">
                                                <i class="bi bi-pencil-square text-info fs-4 me-3"></i>
                                            </a>
                                            <a asp-controller="Todos" asp-action="DeleteTodo" asp-route-id="@item.Id" class="delete-btn text-decoration-none" title="Remove">
                                                <i class="bi bi-trash-fill text-warning fs-4"></i>
                                            </a>
                                        </td>
                                    </tr>
                                </tbody>
                                }
                            </table>

                        </div>
                    </div>

                </div>
            </div>
        </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        // SweetAlert2 setup with Bootstrap button styling
        const swalWithBootstrapButtons = Swal.mixin({
            customClass: {
                confirmButton: "btn btn-success me-2",
                cancelButton: "btn btn-danger"
            },
            buttonsStyling: false
        });

        // Attach click event to all delete buttons
        document.querySelectorAll('.delete-btn').forEach(button => {
            button.addEventListener('click', function (e) {
                e.preventDefault(); // Prevent immediate navigation

                const deleteUrl = this.getAttribute('href'); // Get the controller link

                swalWithBootstrapButtons.fire({
                    title: "Are you sure?",
                    text: "This todo will be permanently deleted.",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonText: "Yes, delete it!",
                    cancelButtonText: "Cancel",
                    reverseButtons: true
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Proceed to delete
                        window.location.href = deleteUrl;
                    } else if (result.dismiss === Swal.DismissReason.cancel) {
                        swalWithBootstrapButtons.fire({
                            title: "Cancelled",
                            text: "Your todo is safe 🙂",
                            icon: "error"
                        });
                    }
                });
            });
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    @if (TempData["Success"] != null)
    {
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 6000,
                    timerProgressBar: true,
                    background: '#198754', // green background
                    color: '#fff',
                    iconColor: '#fff',
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                });

                Toast.fire({
                    icon: 'success',
                    title: 'Todo edited successfully!'
                });
            });
        </script>
    }



</body>

</html>
